<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assistant IA Physique & Chimie</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:
        linear-gradient(135deg, rgba(102,126,234,0.85) 0%, rgba(118,75,162,0.85) 100%),
        url("https://a-static.besthdwallpaper.com/chemistry-and-physics-symbols-on-black-board-wallpaper-1280x800-108136_3.jpg")
        no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 80px;
    }
    .bandeau {
      position: fixed; top:0; left:0; right:0;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 30px;
      color: white; z-index: 10;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .menu-btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 5px 10px;
    }
    .menu-links {
      display: flex;
      gap: 5px;
    }
    .menu-links.hidden {
      display: none;
    }
    .bandeau a {
      color: white; text-decoration: none; margin: 0 12px; font-weight: 500;
      transition: 0.3s;
    }
    .bandeau a:hover {
      color: #dfe6ff; text-decoration: underline;
    }
    .container {
      max-width: 900px; width:100%;
      background: rgba(255,255,255,0.95);
      border-radius:20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      animation: fadeIn 0.5s ease-in;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity:1; transform: translateY(0); }
    }
    .header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; padding: 30px; text-align: center; position: relative; overflow: hidden;
    }
    .header h1 { font-size: 2rem; margin-bottom: 10px; }
    .header p { font-size: 1rem; opacity: 0.9; }
    .chat-container {
      height: 500px; overflow-y: auto; padding: 30px; background: #f8f9fa;
      scroll-behavior: smooth;
    }
    .message {
      margin-bottom: 20px; display: flex; align-items: flex-start;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); }
    }
    .message.user { flex-direction: row-reverse; }
    .message-content {
      max-width: 70%; padding: 15px 20px; border-radius: 15px; line-height: 1.6;
    }
    .message.user .message-content {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border-bottom-right-radius: 5px;
    }
    .message.ai .message-content {
      background: white; color: #333; border-bottom-left-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .avatar {
      width: 40px; height: 40px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.2rem; margin: 0 10px; flex-shrink: 0;
    }
    .message.user .avatar {
      background: linear-gradient(135deg, #f093fb, #f5576c);
    }
    .message.ai .avatar {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
    }
    .formula {
      background: #f0f0f0; padding: 10px 15px; border-radius: 8px;
      margin: 10px 0; font-family: 'Courier New', monospace;
      border-left: 3px solid #667eea;
    }
    .input-container {
      padding: 20px 30px; background: white; border-top: 1px solid #e0e0e0;
      display: flex; gap: 15px;
    }
    .input-container input {
      flex: 1; padding: 15px 20px;
      border: 2px solid #e0e0e0; border-radius: 25px;
      font-size: 1rem; outline: none; transition: all 0.3s;
    }
    .input-container input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
    }
    .input-container button {
      padding: 15px 30px; background: linear-gradient(135deg, #667eea, #764ba2);
      color: white; border: none; border-radius: 25px;
      font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(102,126,234,0.4);
    }
    .input-container button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102,126,234,0.6);
    }
    .input-container button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .examples {
      padding: 15px 30px; background: #f8f9fa; border-top: 1px solid #e0e0e0;
    }
    .example-buttons {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .example-btn {
      padding: 8px 15px; background: white;
      border: 1px solid #e0e0e0; border-radius: 15px;
      font-size: 0.9rem; cursor: pointer; transition: all 0.3s;
      color: #667eea;
    }
    .example-btn:hover {
      background: #667eea; color: white; transform: translateY(-2px);
    }
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-thumb {
      background: #667eea; border-radius: 4px;
    }
    @media (max-width: 768px) {
      .menu-links {
        position: absolute;
        top: 60px;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #667eea, #764ba2);
        flex-direction: column;
        padding: 20px;
      }
    }
  </style>
</head>

<body>
    <div class="bandeau">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="menu-links" id="menuLinks">
          <a href="index.html">Accueil</a>
          <a href="1ere ann√©e.html">Cours</a>
          <a href="Quiz de r√©vision de 1√®re Ann√©e.html">Quiz</a>
          <a href="espaceNote.html">Notes</a>
          <a href="AideAvecIA.html">Questions √† l'aide de l'IA</a>
          <a href="MiniD√©fi.html">Mini d√©fi</a>
          <a href="Connexion √©tudiant.html">Connexion</a>
        </div>
      </div>

  <div class="container">
    <div class="header">
      <h1>üß† Assistant IA Physique-Chimie</h1>
      <p>Pose ta question et obtiens une explication claire et riche !</p>
    </div>

    <div class="chat-container" id="chat-container">
      <div class="message ai">
        <div class="avatar">ü§ñ</div>
        <div class="message-content">
          Bonjour ! Je suis ton assistant IA en physique-chimie.  
          Je peux r√©pondre avec ma base de connaissances locale pour les concepts cl√©s, ou rechercher des informations plus d√©taill√©es si n√©cessaire.
        </div>
      </div>
    </div>

    <div class="examples">
      <div class="example-buttons">
        <button class="example-btn" onclick="askExample('Explique la loi d\'Ohm')">Loi d'Ohm</button>
        <button class="example-btn" onclick="askExample('C\'est quoi l\'√©nergie cin√©tique ?')">√ânergie cin√©tique</button>
        <button class="example-btn" onclick="askExample('Qu\'est-ce que le pH ?')">Le pH</button>
        <button class="example-btn" onclick="askExample('Explique la mole')">La mole</button>
      </div>
    </div>

    <div class="input-container">
      <input type="text" id="user-input" placeholder="Pose ta question ici..." onkeypress="handleKeyPress(event)">
      <button id="send-btn" onclick="sendMessage()">Envoyer</button>
    </div>
  </div>

  <script>
    // === BASE DE CONNAISSANCES LOCALE OPTIMIS√âE ===
    const knowledgeBase = 
    {
     // ======================================================
// üî¨ PHYSIQUE - M√âCANIQUE
// ======================================================
  "loi d'ohm": {
    response: "La loi d'Ohm relie la tension, le courant et la r√©sistance.",
    formula: "U = R √ó I",
    details: "U : V ‚Ä¢ R : Œ© ‚Ä¢ I : A"
  },
  "√©nergie cin√©tique": {
    response: "L'√©nergie cin√©tique est l'√©nergie associ√©e au mouvement.",
    formula: "Ec = ¬Ω m v¬≤",
    details: "m : kg, v : m/s"
  },
  "√©nergie potentielle": {
    response: "L'√©nergie potentielle d√©pend de la position dans un champ gravitationnel.",
    formula: "Ep = m g h",
    details: "h : m, g = 9,81 m/s¬≤"
  },
  "puissance": {
    response: "La puissance est l'√©nergie par unit√© de temps.",
    formula: "P = E / t ou P = U √ó I",
    details: "P : W, E : J, t : s"
  },
  "gravitation": {
    response: "Deux masses s'attirent selon la loi universelle de la gravitation.",
    formula: "F = G (m‚ÇÅ m‚ÇÇ) / r¬≤",
    details: "G = 6,67√ó10‚Åª¬π¬π N¬∑m¬≤/kg¬≤"
  },
  "travail": {
    response: "Le travail d'une force est l'√©nergie transf√©r√©e lors d'un d√©placement.",
    formula: "W = F d cos(Œ∏)",
    details: "Œ∏ : angle entre la force et le d√©placement"
  },
  "vitesse": {
    response: "La vitesse est le rapport distance/temps.",
    formula: "v = d / t",
    details: "d : m, t : s"
  },
  "acc√©l√©ration": {
    response: "Variation de la vitesse par unit√© de temps.",
    formula: "a = Œîv / Œît",
    details: "a : m/s¬≤, Œîv : variation de vitesse"
  },
  "force": {
    response: "La force modifie le mouvement d'un objet (2e loi de Newton).",
    formula: "F = m √ó a",
    details: "F : N, m : kg, a : m/s¬≤"
  },
  "quantit√© de mouvement": {
    response: "Produit de la masse par la vitesse.",
    formula: "p = m √ó v",
    details: "p : kg¬∑m/s, conserv√©e dans un syst√®me isol√©"
  },
  "moment d'inertie": {
    response: "R√©sistance d'un corps √† la rotation.",
    formula: "I = Œ£ m r¬≤",
    details: "Cylindre : I = ¬Ω M R¬≤"
  },
  "couple": {
    response: "Effet de rotation d'une force.",
    formula: "M = F √ó d",
    details: "M : N¬∑m, d : bras de levier"
  },
  "pression": {
    response: "Force par unit√© de surface.",
    formula: "P = F / S",
    details: "P : Pa, F : N, S : m¬≤"
  },
  "masse volumique": {
    response: "Masse par unit√© de volume.",
    formula: "œÅ = m / V",
    details: "œÅ : kg/m¬≥, eau : 1000 kg/m¬≥"
  },
  "pouss√©e d'archim√®de": {
    response: "Un corps immerg√© subit une pouss√©e verticale vers le haut.",
    formula: "F = œÅ √ó V √ó g",
    details: "œÅ : fluide, V : volume immerg√©"
  },

  // ======================================================
  // ‚ö° PHYSIQUE - √âLECTRICIT√â
  // ======================================================
  "r√©sistance": {
    response: "La r√©sistance s'oppose au passage du courant √©lectrique.",
    formula: "R = œÅ √ó L / S",
    details: "œÅ : r√©sistivit√©, L : longueur, S : section"
  },
  "loi des n≈ìuds": {
    response: "La somme des courants entrants √©gale celle des sortants.",
    formula: "Œ£ I_entrant = Œ£ I_sortant",
    details: "Conservation de la charge"
  },
  "loi des mailles": {
    response: "La somme des tensions le long d‚Äôune maille est nulle.",
    formula: "Œ£ U = 0",
    details: "Conservation de l‚Äô√©nergie"
  },
  "r√©sistances en s√©rie": {
    response: "Les r√©sistances s'additionnent.",
    formula: "R_eq = R‚ÇÅ + R‚ÇÇ + R‚ÇÉ + ...",
    details: "M√™me courant traverse toutes les r√©sistances"
  },
  "r√©sistances en parall√®le": {
    response: "L‚Äôinverse de la r√©sistance √©quivalente est la somme des inverses.",
    formula: "1/R_eq = 1/R‚ÇÅ + 1/R‚ÇÇ + ...",
    details: "M√™me tension aux bornes"
  },
  "√©nergie √©lectrique": {
    response: "√ânergie consomm√©e par un appareil.",
    formula: "E = P √ó t ou E = U √ó I √ó t",
    details: "E : J ou Wh, P : W"
  },
  "effet joule": {
    response: "Transformation de l‚Äô√©nergie √©lectrique en chaleur.",
    formula: "Q = R √ó I¬≤ √ó t",
    details: "Q : J (chaleur), perte d‚Äô√©nergie"
  },
  "condensateur": {
    response: "Stocke de l‚Äô√©nergie sous forme √©lectrique.",
    formula: "Q = C √ó U",
    details: "C : F, Q : C"
  },
  "capacit√©": {
    response: "Charge stock√©e par unit√© de tension.",
    formula: "C = Q / U",
    details: "1 F = 1 C/V"
  },
  "inductance": {
    response: "Opposition d'une bobine aux variations de courant.",
    formula: "U = L √ó dI/dt",
    details: "L : H (henry)"
  },

  // ======================================================
  // üåä PHYSIQUE - ONDES ET OPTIQUE
  // ======================================================
  "fr√©quence": {
    response: "Nombre d‚Äôoscillations par seconde.",
    formula: "f = 1 / T",
    details: "f : Hz, T : s"
  },
  "longueur d'onde": {
    response: "Distance entre deux maxima cons√©cutifs.",
    formula: "Œª = c / f",
    details: "Œª : m, c : vitesse de la lumi√®re"
  },
  "vitesse du son": {
    response: "‚âà 340 m/s dans l‚Äôair.",
    formula: "v = d / t",
    details: "D√©pend du milieu et de la temp√©rature"
  },
  "r√©fraction": {
    response: "D√©viation d‚Äôun rayon lumineux changeant de milieu.",
    formula: "n‚ÇÅ sin(i‚ÇÅ) = n‚ÇÇ sin(i‚ÇÇ)",
    details: "Loi de Snell-Descartes"
  },
  "indice de r√©fraction": {
    response: "Mesure la d√©viation de la lumi√®re dans un milieu.",
    formula: "n = c / v",
    details: "c : vide, v : milieu"
  },
  "lentilles convergentes": {
    response: "Fait converger les rayons lumineux.",
    formula: "1/f = 1/p + 1/p'",
    details: "f : focale, p : objet, p' : image"
  },
  "grandissement": {
    response: "Rapport taille image / taille objet.",
    formula: "Œ≥ = p' / p = A'B' / AB",
    details: "Œ≥ > 1 ‚Üí image agrandie"
  },

  // ======================================================
  // üî• PHYSIQUE - THERMODYNAMIQUE
  // ======================================================
  "chaleur": {
    response: "Transfert d‚Äô√©nergie thermique.",
    formula: "Q = m √ó c √ó ŒîT",
    details: "c : capacit√© thermique massique"
  },
  "temp√©rature": {
    response: "Mesure l‚Äôagitation thermique.",
    formula: "T(K) = T(¬∞C) + 273,15",
    details: "0 K = -273,15¬∞C"
  },
  "dilatation": {
    response: "Augmentation de volume avec la temp√©rature.",
    formula: "ŒîL = Œ± √ó L‚ÇÄ √ó ŒîT",
    details: "Œ± : coefficient de dilatation"
  },
  "premier principe": {
    response: "Conservation de l‚Äô√©nergie.",
    formula: "ŒîU = W + Q",
    details: "ŒîU : √©nergie interne, W : travail, Q : chaleur"
  },

  // ======================================================
  // ‚öóÔ∏è CHIMIE - STRUCTURE DE LA MATI√àRE
  // ======================================================
  "ph": {
    response: "Mesure l‚Äôacidit√© d‚Äôune solution.",
    formula: "pH = -log[H‚ÇÉO‚Å∫]",
    details: "pH < 7 acide ‚Ä¢ =7 neutre ‚Ä¢ >7 basique"
  },
  "liaison covalente": {
    response: "Partage d‚Äô√©lectrons entre atomes.",
    details: "Simple, double ou triple"
  },
  "liaison ionique": {
    response: "Transfert d‚Äô√©lectrons entre atomes.",
    details: "Cation (+) et anion (-)"
  },
  "√©lectron√©gativit√©": {
    response: "Capacit√© d‚Äôun atome √† attirer des √©lectrons.",
    details: "F = 4,0 (max sur l‚Äô√©chelle de Pauling)"
  },
  "configuration √©lectronique": {
    response: "R√©partition des √©lectrons autour du noyau.",
    details: "Ex : O (Z=8) : 1s¬≤ 2s¬≤ 2p‚Å¥"
  },
  "orbitales": {
    response: "R√©gions o√π la probabilit√© de trouver un √©lectron est √©lev√©e.",
    details: "Types : s, p, d, f"
  },
  "tableau p√©riodique": {
    response: "Classe les √©l√©ments par num√©ro atomique croissant.",
    details: "118 √©l√©ments, 7 p√©riodes, 18 groupes"
  },

  // ======================================================
  // üß™ CHIMIE - QUANTIT√â DE MATI√àRE
  // ======================================================
  "mole": {
    response: "Contient 6,022√ó10¬≤¬≥ entit√©s.",
    formula: "n = m / M",
    details: "n : mol, m : g, M : g/mol"
  },
  "masse molaire": {
    response: "Masse d‚Äôune mole de substance.",
    formula: "M = m / n",
    details: "M : g/mol"
  },
  "concentration molaire": {
    response: "Quantit√© de mati√®re par volume.",
    formula: "C = n / V",
    details: "C : mol/L"
  },
  "concentration massique": {
    response: "Masse de solut√© par volume.",
    formula: "Cm = m / V",
    details: "Cm : g/L"
  },
  "dilution": {
    response: "Diminue la concentration d‚Äôune solution.",
    formula: "C‚ÇÅV‚ÇÅ = C‚ÇÇV‚ÇÇ",
    details: "Quantit√© de mati√®re conserv√©e"
  },
  "volume molaire": {
    response: "Volume d‚Äôune mole de gaz.",
    formula: "Vm = V / n = 22,4 L/mol",
    details: "0¬∞C, 1 atm"
  },

  // ======================================================
  // ‚öõÔ∏è CHIMIE - R√âACTIONS CHIMIQUES
  // ======================================================
  "r√©action chimique": {
    response: "Transforme des r√©actifs en produits.",
    details: "Ex : 2 H‚ÇÇ + O‚ÇÇ ‚Üí 2 H‚ÇÇO"
  },
  "√©quilibrage": {
    response: "Respecte la conservation des atomes.",
    details: "M√™me nombre d‚Äôatomes de chaque c√¥t√©"
  },
  "st≈ìchiom√©trie": {
    response: "√âtudie les proportions des substances r√©agissant.",
    details: "Bas√©e sur les coefficients de l‚Äô√©quation"
  },
  "r√©actif limitant": {
    response: "R√©actif consomm√© en premier.",
    details: "D√©termine la quantit√© de produits"
  },
  "rendement": {
    response: "Rapport obtenu/th√©orique.",
    formula: "Œ∑ = (n_r√©el / n_th√©orique) √ó 100",
    details: "Œ∑ : %, souvent < 100%"
  },
  "oxydor√©duction": {
    response: "Transfert d‚Äô√©lectrons entre esp√®ces.",
    details: "Oxydation = perte e‚Åª, R√©duction = gain e‚Åª"
  },
  "oxydant": {
    response: "Capte des √©lectrons.",
    details: "Se r√©duit"
  },
  "r√©ducteur": {
    response: "C√®de des √©lectrons.",
    details: "S‚Äôoxyde"
  },
  "nombre d'oxydation": {
    response: "Degr√© d‚Äôoxydation d‚Äôun √©l√©ment.",
    details: "Change lors des r√©actions redox"
  },
  "pile √©lectrochimique": {
    response: "Convertit √©nergie chimique ‚Üí √©lectrique.",
    details: "Oxydation : anode ‚Ä¢ R√©duction : cathode"
  },

  // ======================================================
  // ‚öñÔ∏è CHIMIE - ACIDES ET BASES
  // ======================================================
  "acide": {
    response: "C√®de un proton H‚Å∫.",
    details: "Ex : HCl, H‚ÇÇSO‚ÇÑ, CH‚ÇÉCOOH"
  },
  "base": {
    response: "Capte un proton H‚Å∫.",
    details: "Ex : OH‚Åª, NH‚ÇÉ, HCO‚ÇÉ‚Åª"
  },
  "couple acide-base": {
    response: "Acide et sa base conjugu√©e.",
    details: "Ex : CH‚ÇÉCOOH / CH‚ÇÉCOO‚Åª"
  },
  "neutralisation": {
    response: "R√©action entre acide et base.",
    formula: "H‚ÇÉO‚Å∫ + OH‚Åª ‚Üí 2 H‚ÇÇO",
    details: "Produit de l‚Äôeau et un sel"
  },
  "indicateur color√©": {
    response: "Change de couleur selon le pH.",
    details: "Ex : BBT (jaune <6, bleu >7,6)"
  },
  "constante d'acidit√©": {
    response: "Mesure la force d‚Äôun acide.",
    formula: "Ka = [A‚Åª][H‚ÇÉO‚Å∫] / [AH]",
    details: "pKa = -log(Ka)"
  },
  "tampon": {
    response: "R√©siste aux variations de pH.",
    details: "M√©lange acide faible / base conjugu√©e"
  },

  // ======================================================
  // üí® CHIMIE - GAZ
  // ======================================================
  "gaz parfait": {
    response: "Respecte PV = nRT.",
    formula: "PV = nRT",
    details: "R = 8,31 J/(mol¬∑K)"
  },
  "loi de boyle": {
    response: "P √ó V = constante (T constante).",
    formula: "P‚ÇÅV‚ÇÅ = P‚ÇÇV‚ÇÇ",
    details: "Transformation isotherme"
  },
  "loi de charles": {
    response: "V/T = constante (P constante).",
    formula: "V‚ÇÅ/T‚ÇÅ = V‚ÇÇ/T‚ÇÇ",
    details: "Isobare, T en K"
  },
  "loi de gay-lussac": {
    response: "P/T = constante (V constante).",
    formula: "P‚ÇÅ/T‚ÇÅ = P‚ÇÇ/T‚ÇÇ",
    details: "Isochore, T en K"
  }
};
    

    // === SYNONYMES / MOTS-CL√âS POUR RECHERCHE INTELLIGENTE ===
    const keywords = {
      "tension": "loi d'ohm",
      "courant": "loi d'ohm",
      "r√©sistance": "loi d'ohm",
      "ohm": "loi d'ohm",
      "mouvement": "√©nergie cin√©tique",
      "cin√©tique": "√©nergie cin√©tique",
      "force": "travail",
      "gravit√©": "gravitation",
      "poids": "gravitation",
      "potentielle": "√©nergie potentielle",
      "acide": "ph",
      "basique": "ph",
      "liaison": "liaison covalente",
      "covalente": "liaison covalente",
      "mole": "mole",
      "r√©action": "r√©action chimique",
      "√©lectrons": "oxydor√©duction",
      "redox": "oxydor√©duction",
      "gaz": "gaz parfait"
    };

    let isProcessing = false;

    // === FONCTION TOGGLE MENU ===
    function toggleMenu() {
      const menu = document.getElementById("menuLinks");
      menu.classList.toggle("hidden");
    }

    // === FONCTIONS D'AFFICHAGE ===
    function addMessage(content, isUser = false, formula = "", details = "", messageId = null) {
      const chat = document.getElementById("chat-container");
      const div = document.createElement("div");
      div.className = `message ${isUser ? "user" : "ai"}`;
      if (messageId) div.id = messageId;
      div.innerHTML = `
        <div class="avatar">${isUser ? "üë§" : "ü§ñ"}</div>
        <div class="message-content">
          ${content}
          ${formula ? `<div class="formula">${formula}</div>` : ""}
          ${details ? `<div style="margin-top:10px;font-size:0.9rem;">${details}</div>` : ""}
        </div>`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }

    // === RECHERCHE DANS LA BASE LOCALE ===
    function findAnswerLocal(question) {
      const lower = question.toLowerCase();
      for (const key in knowledgeBase) {
        if (lower.includes(key)) {
          return knowledgeBase[key];
        }
      }
      for (const kw in keywords) {
        if (lower.includes(kw)) {
          const target = keywords[kw];
          return knowledgeBase[target];
        }
      }
      return null;
    }

    // === APPEL √Ä L'IA EXTERNE VIA OPENAI ===
    async function askAI(question) {
      const apiKey = "YOUR_OPENAI_API_KEY_HERE";
      
      // V√©rification de la cl√© API
      if (apiKey === "YOUR_OPENAI_API_KEY_HERE" || !apiKey) {
        return "‚ö†Ô∏è La cl√© API OpenAI n'est pas configur√©e. Pour activer l'IA externe, remplacez 'YOUR_OPENAI_API_KEY_HERE' par votre vraie cl√© API dans le code.";
      }

      try {
        const resp = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              {
                role: "system",
                content: "Tu es un assistant expert en physique et chimie, tu expliques clairement les concepts, formules, exercices."
              },
              {
                role: "user",
                content: question
              }
            ],
            temperature: 0.7
          })
        });

        if (!resp.ok) {
          const errorData = await resp.json();
          console.error("Erreur API:", errorData);
          return `‚ùå Erreur API (${resp.status}): ${errorData.error?.message || 'Erreur inconnue'}`;
        }

        const data = await resp.json();
        if (data.choices && data.choices[0].message.content) {
          return data.choices[0].message.content;
        } else {
          return "‚ùå R√©ponse invalide de l'API.";
        }
      } catch (err) {
        console.error("Erreur OpenAI:", err);
        return `‚ùå Erreur de connexion: ${err.message}`;
      }
    }

    // === ENVOI DE MESSAGE ===
    async function sendMessage() {
      if (isProcessing) return;

      const input = document.getElementById("user-input");
      const sendBtn = document.getElementById("send-btn");
      const question = input.value.trim();
      
      if (!question) return;

      isProcessing = true;
      sendBtn.disabled = true;
      
      addMessage(question, true);
      input.value = "";

      // D'abord regarder dans la base locale
      const localAns = findAnswerLocal(question);
      if (localAns) {
        addMessage(localAns.response, false, localAns.formula, localAns.details);
        isProcessing = false;
        sendBtn.disabled = false;
      } else {
        // Afficher le message de chargement avec un ID unique
        const loadingMsg = addMessage("‚è≥ Je r√©fl√©chis‚Ä¶", false, "", "", "loading-message");
        
        const aiResponse = await askAI(question);
        
        // Retirer le message de chargement
        if (loadingMsg && loadingMsg.parentElement) {
          loadingMsg.remove();
        }
        
        addMessage(aiResponse, false);
        isProcessing = false;
        sendBtn.disabled = false;
      }
    }

    function askExample(q) {
      document.getElementById("user-input").value = q;
      sendMessage();
    }

    function handleKeyPress(e) {
      if (e.key === "Enter" && !isProcessing) {
        sendMessage();
      }
    }

    window.onload = function() {
      document.getElementById("user-input").focus();
    };
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz Physique-Chimie - Premi√®re ‚ú®</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<style>
/* 1. RESET & BASE (Th√®me Sombre/Magique) */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #e0e0e0; /* Texte clair pour le fond sombre */
    
    /* MODIFICATION 1 : √âviter la multiplication des images et assurer une couverture totale */
    background: url('https://e0.pxfuel.com/wallpapers/955/776/desktop-wallpaper-assassins-creed-4-logo-version-black-flag-game-2013-assassin-s-creed-logo.jpg') no-repeat center center fixed;
    background-size: cover;
    background-repeat: no-repeat; /* Ajout√© */
    background-attachment: fixed; /* Ajout√© pour un meilleur effet */
    
    min-height: 100vh;
    padding: 20px 20px 80px 20px; /* Plus d'espace pour le footer */
    background-color: #1a1a2e; /* Couleur de secours */
}

.container {
    max-width: 1000px;
    margin: 0 auto;
}

/* 2. HEADER */
header {
    text-align: center;
    padding: 40px 20px;
    margin-bottom: 40px;
    color: white;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.8);
    
    /* Fond plus sombre et th√©matique pour le header */
    background: linear-gradient(rgba(16, 16, 32, 0.8), rgba(16, 16, 32, 0.8)), 
                url('https://e1.pxfuel.com/desktop-wallpaper/344/998/desktop-wallpaper-assassin-s-creed-for-pc-10041-assassin-creed.jpg') no-repeat center center;
    background-size: cover;
    border-radius: 15px;
    border: 2px solid #5757a3;
    box-shadow: 0 8px 15px rgba(0,0,0,0.4);
}

h1 {
    font-size: 2.8rem;
    margin-bottom: 5px;
    color: #92dff3; /* Titre bleu clair */
}

.subtitle {
    font-size: 1.3rem;
    opacity: 0.9;
    font-style: italic;
}

/* 3. CONTENEURS DU QUIZ/CLASSEMENT (Effet Verre D√©poli) */
.quiz-container,
.leaderboard-container {
    background: rgba(255, 255, 255, 0.1); /* Fond l√©g√®rement transparent */
    backdrop-filter: blur(8px); /* Effet de flou accru */
    -webkit-backdrop-filter: blur(8px);
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    overflow: hidden;
    margin-bottom: 30px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.quiz-header,
.leaderboard-header {
    background: #0d1a33; /* Bleu tr√®s fonc√© pour l'ent√™te */
    color: white;
    padding: 25px;
    text-align: center;
    border-bottom: 2px solid #5757a3;
}

.quiz-header h2,
.leaderboard-header h2 {
    font-size: 1.8rem;
}

.quiz-body,
.leaderboard-body {
    padding: 30px;
}

/* 4. QUESTIONS */
.question {
    margin-bottom: 30px;
    padding: 20px;
    border: none; 
    border-radius: 10px;
    background: rgba(0, 0, 0, 0.3); /* Fond sombre pour la question */
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.question-number {
    font-weight: 600;
    color: #ffcc00; /* Jaune Th√©matique */
    margin-bottom: 10px;
    font-size: 1.1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    padding-bottom: 5px;
}

.question-text {
    font-weight: bold;
    margin-bottom: 15px;
    font-size: 1.2rem;
    color: #ffffff;
}

.options {
    display: flex; /* Utilisation de flex pour aligner Vrai/Faux ou 4 options */
    flex-direction: column;
    gap: 10px;
}

.option {
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    cursor: pointer;
    background: rgba(255, 255, 255, 0.05);
    color: #e0e0e0;
}

.option:hover {
    background: rgba(70, 70, 150, 0.3); /* Bleu fonc√© au survol */
    border-color: #5757a3;
}

.option input[type="radio"]:checked + span { 
    font-weight: bold;
    color: #92dff3; /* Texte de l'option s√©lectionn√©e en bleu clair */
}


/* 5. BOUTONS */
.buttons {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    justify-content: center;
}

.btn {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    cursor: pointer;
    transition: background 0.3s;
}

.submit-btn {
    background: #5757a3;
    color: white;
}

.reset-btn {
    background: #e74c3c;
    color: white;
}

.save-score-btn {
    background: #2ecc71;
    color: white;
}

.show-leaderboard-btn {
    background: #9b59b6;
    color: white;
}

/* Style pour le bouton PDF */
.pdf-btn {
    background: #3498db; /* Bleu vif */
    color: white;
}
.pdf-btn:hover {
    background: #2980b9;
}

/* 6. R√âSULTATS */
.results {
    margin-top: 30px;
    padding: 20px;
    border-radius: 10px;
    background: rgba(16, 16, 32, 0.8);
    border: 1px solid #5757a3;
    color: white;
    text-align: center;
}

.score {
    font-size: 2rem;
    font-weight: bold;
    color: #ffcc00;
    margin-bottom: 10px;
}

.score-details {
    color: #b0b0b0;
    margin-bottom: 15px;
}

.message {
    font-weight: bold;
    font-size: 1.4rem;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 15px;
}

.excellent {
    background: #27ae60;
    color: white;
}

.good {
    background: #f1c40f;
    color: #333;
}

.average {
    background: #e74c3c;
    color: white;
}

/* Style pour l'input du nom */
.save-score-input {
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #5757a3;
    background: #1a1a2e;
    color: white;
    margin-right: 10px;
    max-width: 200px;
    text-align: center;
}
.save-score-input:disabled {
    opacity: 0.7;
    background: #0d1a33;
    cursor: default;
}


/* 7. CLASSEMENT - MODIFI√â POUR LES COULEURS ET LE TOP 3 */
.leaderboard-table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    overflow: hidden;
}

.leaderboard-table th,
.leaderboard-table td {
    padding: 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    color: #e0e0e0;
    text-align: left;
}
.leaderboard-table td:first-child,
.leaderboard-table th:first-child {
    text-align: center; /* Centrer le num√©ro de classement */
}

.leaderboard-table th {
    background: #0d1a33; /* Bleu tr√®s fonc√© pour l'ent√™te (identique au quiz-header) */
    color: #92dff3; /* Bleu clair th√©matique */
    font-size: 1.1rem;
}

/* Ligne impaire (couleur de base) */
.leaderboard-table tr { 
    background: rgba(255, 255, 255, 0.05); /* Ligne impaire (presque transparente) */
}

/* Ligne paire (couleur altern√©e pour le contraste) */
.leaderboard-table tr:nth-child(even) {
    background: rgba(16, 16, 32, 0.5); /* Bleu fonc√© l√©g√®rement transparent */
}
.leaderboard-table tr:hover {
    background: rgba(70, 70, 150, 0.3); /* Bleu fonc√© plus prononc√© au survol */
}

/* --- NOUVEAUX STYLES POUR METTRE EN √âVIDENCE LE TOP 3 --- */

/* Style pour la premi√®re place (or) */
.leaderboard-table tr:nth-child(1) {
    background: rgba(255, 215, 0, 0.2) !important; /* Jaune/Or tr√®s clair */
    color: #ffd700;
    font-weight: bold;
}
.leaderboard-table tr:nth-child(1) td:first-child { 
    color: #ffd700; 
    font-size: 1.3rem; 
    text-shadow: 0 0 5px rgba(255, 215, 0, 0.8);
}

/* Style pour la deuxi√®me place (argent) */
.leaderboard-table tr:nth-child(2) {
    background: rgba(192, 192, 192, 0.2) !important;
}
.leaderboard-table tr:nth-child(2) td:first-child { 
    color: #c0c0c0; 
    font-size: 1.2rem;
}

/* Style pour la troisi√®me place (bronze) */
.leaderboard-table tr:nth-child(3) {
    background: rgba(205, 127, 50, 0.2) !important;
}
.leaderboard-table tr:nth-child(3) td:first-child { 
    color: #cd7f32; 
    font-size: 1.1rem; 
}


/* 8. FOOTER */
footer {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    text-align: center;
    padding: 15px;
    color: #b0b0b0;
    font-size: 0.85rem;
    background-color: rgba(16, 16, 32, 0.95);
    border-top: 2px solid #5757a3;
    box-shadow: 0 -2px 8px rgba(0,0,0,0.5);
    z-index: 10;
}

/* 9. ACC√àS REFUS√â */
#access-denied-message {
    padding: 30px;
    text-align: center;
    border-radius: 15px;
    max-width: 500px;
    margin: 50px auto;
    background: rgba(16, 16, 32, 0.9);
    border: 1px solid #c0392b;
    color: white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}
#access-denied-message h2 {
    color: #e74c3c;
    margin-bottom: 10px;
}
#access-denied-message p {
    margin-bottom: 20px;
}
#access-denied-message a {
    display: inline-block;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 5px;
    background: #5757a3;
    color: white;
    transition: background 0.3s;
}
#access-denied-message a:hover {
    background: #46468a;
}
</style>
</head>
<body>
<div class="container">
<header>
    <h1>QCM de Physique-Chimie</h1>
    <p class="subtitle">Niveau Premi√®re - Testez vos connaissances ‚ú®</p>
</header>

<div id="quiz-content">
    <div class="quiz-container" id="quiz-container">
        <div class="quiz-header">
            <h2>Questionnaire √† Choix Multiples</h2>
            <p>20 questions g√©n√©r√©es al√©atoirement</p>
        </div>
        <div class="quiz-body">
            <div id="quiz"></div>
            <div class="buttons">
                <button class="btn submit-btn" onclick="checkAnswers()">Soumettre les r√©ponses</button>
                <button class="btn reset-btn" onclick="resetQuiz()">R√©initialiser</button>
            </div>

            <div class="results" id="results" style="display:none;"> <div class="score" id="score"></div>
                <div class="score-details" id="score-details"></div>
                <div class="message" id="message"></div>

                <div class="save-score-container" id="save-score-container" style="display:flex; justify-content:center; align-items:center; margin-bottom: 20px;">
                    <input type="text" class="save-score-input" id="player-name" placeholder="Entrez votre nom" maxlength="20">
                    <button class="btn save-score-btn" onclick="saveScore()">Enregistrer mon score</button>
                </div>

                <div class="buttons">
                    <button class="btn show-leaderboard-btn" onclick="showLeaderboard()">Voir le classement</button>
                    <button class="btn pdf-btn" onclick="generatePDF()">T√©l√©charger le corrig√© (PDF)</button>
                    <button class="btn reset-btn" onclick="resetQuiz()">Refaire le quiz</button>
                </div>
            </div>
        </div>
    </div>

    <div class="leaderboard-container" id="leaderboard-container" style="display:none;">
        <div class="leaderboard-header">
            <h2>Classement Personnel</h2>
        </div>
        <div class="leaderboard-body">
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Nom</th>
                        <th>Score</th>
                        <th>Date</th>
                        <th>Commentaire</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
            <div class="buttons" style="justify-content:center; margin-top:30px;">
                <button class="btn submit-btn" onclick="hideLeaderboard()">Retour au quiz</button>
                <button class="btn reset-btn" onclick="clearLeaderboard()">Effacer mon classement</button>
            </div>
        </div>
    </div>
</div>

<div id="access-denied-message" style="display:none;">
    <h2>üîí Acc√®s Restreint</h2>
    <p>Vous devez √™tre connect√© pour acc√©der √† ce quiz.</p>
    <a href="Connexion √©tudiant.html">Se connecter</a>
</div>

<footer style="margin-top: 50px;">
<p>&copy; 2025 Nguyen Thomas. Tous droits r√©serv√©s.</p>
</footer>
</div>

<script>
// --- CONFIGURATION DE S√âCURIT√â & INITIALISATION ---
const quizContent = document.getElementById('quiz-content');
const accessDeniedMessage = document.getElementById('access-denied-message');

function setPlayerNameFromLogin(username) {
    const playerNameInput = document.getElementById('player-name');
    if (playerNameInput) {
        playerNameInput.value = username; 
        playerNameInput.disabled = true; 
        playerNameInput.placeholder = `Connect√© comme : ${username}`;
    }
}

function checkLoginStatus() {
    const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
    const username = localStorage.getItem('currentUser'); 
    if (!isLoggedIn || !username) {
        quizContent.style.display = 'none';
        accessDeniedMessage.style.display = 'block';
        return false; 
    } else {
        quizContent.style.display = 'block';
        accessDeniedMessage.style.display = 'none';
        setPlayerNameFromLogin(username);
        return true;
    }
}

// --- QUESTIONS (20 questions, y compris 5 Vrai/Faux) ---
const questions = [
    {
        text: "Quelle est la formule de l‚Äô√©nergie cin√©tique ?",
        options: { a: "Ec = mv", b: "Ec = 1/2 mv¬≤", c: "Ec = m/v", d: "Ec = m√óv¬≤" },
        answer: "b"
    },
    {
        text: "Quelle est l‚Äôunit√© de la force ?",
        options: { a: "Joule", b: "Newton", c: "Pascal", d: "Watt" },
        answer: "b"
    },
    {
        text: "Quelle est la loi reliant U, R et I ?",
        options: { a: "Loi de Newton", b: "Loi d‚ÄôOhm", c: "Loi de Coulomb", d: "Loi de Joule" },
        answer: "b"
    },
    {
        text: "Quelle est la formule de la masse volumique ?",
        options: { a: "œÅ = m/V", b: "œÅ = V/m", c: "œÅ = m√óV", d: "œÅ = m+V" },
        answer: "a"
    },
    {
        text: "Quelle est la constante de gravitation universelle ?",
        options: { a: "9,81", b: "6,67√ó10‚Åª¬π¬π", c: "3√ó10‚Å∏", d: "1,6√ó10‚Åª¬π‚Åπ" },
        answer: "b"
    },
    {
        text: "Quelle est l‚Äôunit√© de la pression ?",
        options: { a: "Pa", b: "N", c: "J", d: "W" },
        answer: "a"
    },
    {
        text: "Quelle particule n‚Äôa pas de charge ?",
        options: { a: "Proton", b: "Neutron", c: "√âlectron", d: "Ion" },
        answer: "b"
    },
    {
        text: "Quelle est la vitesse de la lumi√®re ?",
        options: { a: "3√ó10‚Å∏ m/s", b: "9,8 m/s¬≤", c: "1,6√ó10‚Åª¬π‚Åπ m/s", d: "6,02√ó10¬≤¬≥ m/s" },
        answer: "a"
    },
    {
        text: "Quelle est la charge √©l√©mentaire ?",
        options: { a: "9,81 N", b: "6,67√ó10‚Åª¬π¬π N.m¬≤/kg¬≤", c: "1,6√ó10‚Åª¬π‚Åπ C", d: "3√ó10‚Å∏ m/s" },
        answer: "c"
    },
    {
        text: "Quelle loi d√©crit la force √©lectrostatique ?",
        options: { a: "Loi de Coulomb", b: "Loi de Newton", c: "Loi d‚ÄôOhm", d: "Loi de Joule" },
        answer: "a"
    },
    {
        text: "Quelle est la formule de la vitesse ?",
        options: { a: "v = d/t", b: "v = t/d", c: "v = d√ót", d: "v = d-t" },
        answer: "a"
    },
    {
        text: "Quelle est l‚Äôunit√© de l‚Äô√©nergie ?",
        options: { a: "Joule", b: "Newton", c: "Watt", d: "Volt" },
        answer: "a"
    },
    {
        text: "Quelle est l‚Äô√©quation de la loi des gaz parfaits ?",
        options: { a: "PV = nRT", b: "P = F/S", c: "E = mc¬≤", d: "U = RI" },
        answer: "a"
    },
    {
        text: "Quelle est l‚Äôunit√© de la puissance √©lectrique ?",
        options: { a: "Watt", b: "Joule", c: "Volt", d: "Amp√®re" },
        answer: "a"
    },
    {
        text: "La lumi√®re se comporte comme :",
        options: { a: "Une onde", b: "Une particule", c: "Les deux", d: "Ni l‚Äôun ni l‚Äôautre" },
        answer: "c"
    },
    // --- QUESTIONS VRAI/FAUX ---
    {
        text: "L'√©nergie potentielle de pesanteur d'un objet d√©pend de sa vitesse.",
        options: { a: "Vrai", b: "Faux" },
        answer: "b"
    },
    {
        text: "Dans une solution aqueuse, le pH est d'autant plus faible que la concentration en ions H‚ÇÉO‚Å∫ est √©lev√©e.",
        options: { a: "Vrai", b: "Faux" },
        answer: "a"
    },
    {
        text: "Le principe d'inertie (premi√®re loi de Newton) stipule qu'un objet soumis √† des forces qui se compensent est n√©cessairement immobile.",
        options: { a: "Vrai", b: "Faux" },
        answer: "b"
    },
    {
        text: "Un atome est √©lectriquement neutre car il poss√®de autant de protons que de neutrons.",
        options: { a: "Vrai", b: "Faux" },
        answer: "b"
    },
    {
        text: "La puissance √©lectrique P consomm√©e par un dip√¥le s'exprime par la relation P = R √ó I¬≤.",
        options: { a: "Vrai", b: "Faux" },
        answer: "a"
    }
];


function shuffle(array){ return array.sort(()=>Math.random()-0.5); }

function loadQuiz(){
    if (!checkLoginStatus()) return;
    const quizDiv=document.getElementById("quiz");
    quizDiv.innerHTML="";
    
    const shuffled = shuffle([...questions]);
    window.currentQuestions=shuffled.slice(0, 20);
    
    window.currentQuestions.forEach((q,i)=>{
        // CORRECTION DE D√âBOGAGE ICI : Encapsuler l'input et le texte dans la balise <label> pour que le clic fonctionne sur toute la zone et le CSS s'applique correctement. J'utilise un <span> pour appliquer le style du texte via CSS.
        quizDiv.innerHTML+=`
        <div class="question">
            <div class="question-number">Question ${i+1}/${window.currentQuestions.length}</div>
            <div class="question-text">${q.text}</div>
            <div class="options">
                ${Object.entries(q.options).map(([k,v])=>`
                <label class="option">
                    <input type="radio" name="q${i}" value="${k}"> 
                    <span>${k}) ${v}</span>
                </label>`).join('')}
            </div>
        </div>`;
    });
    document.getElementById('results').style.display='none';
    document.getElementById('save-score-container').style.display='none';
}

function checkAnswers(){
    let score=0;
    const allQuestions=document.querySelectorAll('.question');
    allQuestions.forEach((qDiv,i)=>{
        const selected=qDiv.querySelector("input[type=radio]:checked");
        if(selected && window.currentQuestions[i] && selected.value===window.currentQuestions[i].answer) score++;
    });

    document.getElementById('score').textContent=`Score: ${score}/${allQuestions.length}`;
    document.getElementById('score-details').textContent=`Vous avez r√©pondu correctement √† ${score} questions sur ${allQuestions.length}.`;
    const messageElement=document.getElementById('message');
    if(score>=18){ messageElement.textContent="Excellent ! üåü"; messageElement.className="message excellent"; }
    else if(score>=15){ messageElement.textContent="Tr√®s Bien ! üí™"; messageElement.className="message good"; }
    else if(score>=12){ messageElement.textContent="Bien jou√© ! ü§î"; messageElement.className="message good"; }
    else{ messageElement.textContent="Continuez √† r√©viser. üìö"; messageElement.className="message average"; }

    document.getElementById('save-score-container').style.display='flex';
    document.getElementById('results').style.display='block';
}

function saveScore(){
    if (!checkLoginStatus()) return;
    
    const username = localStorage.getItem('currentUser'); 
    const playerName = document.getElementById('player-name').value.trim(); 

    if(!playerName){ 
        alert("Erreur: L'identifiant du joueur est manquant. Veuillez vous reconnecter."); 
        return; 
    }

    const key = `quizScores_${username}`;
    const scores=JSON.parse(localStorage.getItem(key))||[];

    const scoreText = document.getElementById('score').textContent;
    const match = scoreText.match(/Score: (\d+)\/(\d+)/);
    if (!match) { alert("Erreur lors de la r√©cup√©ration du score."); return; }

    const scoreValue = parseInt(match[1]);
    const totalValue = parseInt(match[2]);

    scores.push({name:playerName, score:scoreValue, total:totalValue, date:new Date().toLocaleDateString('fr-FR')});
    scores.sort((a,b)=>((b.score/b.total)-(a.score/a.total)));
    localStorage.setItem(key,JSON.stringify(scores.slice(0,10)));

    alert(`Score enregistr√© avec succ√®s, ${playerName}!`);
    document.getElementById('save-score-container').style.display='none';
}

function getComment(score,total){
    const pct=(score/total)*100;
    if(pct>=90) return "Excellent üåü";
    if(pct>=80) return "Tr√®s Bien üëç";
    if(pct>=60) return "Bien jou√© üôÇ";
    if(pct>=40) return "Peut mieux faire üòê";
    return "√Ä revoir üî¥";
}

function showLeaderboard(){
    if (!checkLoginStatus()) return;
    const username = localStorage.getItem('currentUser');
    const key = `quizScores_${username}`;

    const leaderboard=document.getElementById('leaderboard-container');
    const body=document.getElementById('leaderboard-body');
    const scores=JSON.parse(localStorage.getItem(key))||[];

    body.innerHTML='';
    if(scores.length===0) body.innerHTML='<tr><td colspan="5" style="text-align:center; color: #b0b0b0;">Aucun score enregistr√© pour vous.</td></tr>';
    else{
        scores.forEach((s,i)=>{
            const pct=((s.score/s.total)*100).toFixed(1);
            const comment=getComment(s.score,s.total);
            body.innerHTML+=`<tr>
                <td>${i+1}</td>
                <td>${s.name}</td>
                <td>${s.score}/${s.total} (${pct}%)</td>
                <td>${s.date}</td>
                <td>${comment}</td>
            </tr>`;
        });
    }
    document.getElementById('quiz-container').style.display='none';
    leaderboard.style.display='block';
}

function hideLeaderboard(){
    document.getElementById('leaderboard-container').style.display='none';
    document.getElementById('quiz-container').style.display='block';
}

function clearLeaderboard(){
    if (!checkLoginStatus()) return;
    const username = localStorage.getItem('currentUser');
    const key = `quizScores_${username}`;
    if(confirm("Voulez-vous vraiment effacer votre classement personnel ?")){
        localStorage.removeItem(key);
        document.getElementById('leaderboard-body').innerHTML='<tr><td colspan="5" style="text-align:center; color: #b0b0b0;">Aucun score enregistr√© pour vous.</td></tr>';
        alert("Votre classement a √©t√© effac√© !");
    }
}

function resetQuiz(){ loadQuiz(); }

// Fonction utilitaire pour obtenir la valeur de l'option (e.g. 'b' -> '1/2 mv¬≤')
function getOptionValue(question, answerKey) {
    return question.options[answerKey] ? `${answerKey}) ${question.options[answerKey]}` : answerKey;
}

// FONCTION PDF : G√©n√®re et t√©l√©charge le corrig√©
function generatePDF() {
    if (!window.currentQuestions || window.currentQuestions.length === 0) {
        alert("Veuillez d'abord compl√©ter et soumettre le quiz pour g√©n√©rer le corrig√©.");
        return;
    }

    // R√©cup√©rer la librairie window.jsPDF
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    let y = 10;
    const margin = 10;
    const lineHeight = 7;
    const maxWidth = 190;
    
    // Titre
    doc.setFontSize(16);
    doc.text("Corrig√© du QCM de Physique-Chimie", margin, y);
    y += lineHeight * 2;

    doc.setFontSize(12);
    
    // Parcourir les questions
    window.currentQuestions.forEach((q, i) => {
        const questionNumber = `Question ${i + 1}/${window.currentQuestions.length} : `;
        const questionText = q.text;
        const correctAnswer = q.answer;
        const answerText = getOptionValue(q, correctAnswer);

        // G√©rer le saut de page automatique
        if (y > doc.internal.pageSize.height - margin * 2) {
            doc.addPage();
            y = margin;
        }

        doc.setFont('helvetica', 'bold');
        doc.text(questionNumber, margin, y, { maxWidth: maxWidth });
        
        // Simuler le texte de la question qui peut √™tre long
        doc.setFont('helvetica', 'normal');
        const textLines = doc.splitTextToSize(questionText, maxWidth);
        doc.text(textLines, margin, y + 5, { maxWidth: maxWidth }); // Le texte commence sous le num√©ro
        y += textLines.length * lineHeight; 
        
        // Afficher la bonne r√©ponse
        doc.setFont('helvetica', 'italic');
        doc.setTextColor(34, 139, 34); // Vert for√™t pour la r√©ponse
        doc.text(`R√©ponse : ${answerText}`, margin + 5, y + 2);
        doc.setTextColor(0, 0, 0); // Remettre le noir pour le texte par d√©faut
        doc.setFont('helvetica', 'normal');
        y += lineHeight * 2;
    });

    // Enregistrement du PDF
    doc.save("Corrig√©_Quiz_Physique_Chimie.pdf");
}

window.onload = function() {
    if (checkLoginStatus()) loadQuiz();
};

</script>
</body>
</html>

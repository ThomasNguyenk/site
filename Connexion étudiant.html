<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Authentification Étudiant</title>
<style>
    body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    background-image: url('https://preview.redd.it/new-assassins-creed-mirage-legacy-4k-wallpaper-that-ubisoft-v0-1yingsop7u5b1.png?auto=webp&s=3626fff045824a5861adf9cf15bb93119567b462'); 
    background-size: cover; 
    background-attachment: fixed; 
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
    .login-box {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        width: 100%;
        max-width: 350px;
        text-align: center;
    }
    .login-box h2 {
        margin-bottom: 20px;
        color: #333;
    }
    .login-box input[type="text"], 
    .login-box input[type="password"],
    /* Suppression de la classe 'select' du style car elle est retirée du HTML */
    .login-box select { 
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    .login-box button {
        width: 100%;
        padding: 10px;
        background-color: #5cb85c;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        margin-bottom: 10px; /* Espace sous les boutons */
    }
    /* Style spécifique pour le bouton d'inscription */
    .login-box #registerBtn { 
        background-color: #007bff; /* Bleu pour l'inscription */
    }
    .login-box #registerBtn:hover { 
        background-color: #0056b3; 
    }
    .login-box button:hover {
        background-color: #4cae4c;
    }
    /* Style pour le bouton de bascule vers l'inscription */
    .toggle-link {
        color: #007bff;
        cursor: pointer;
        text-decoration: underline;
        font-size: 14px;
        display: block;
        margin-top: 10px;
    }
    .error-message {
        color: red;
        margin-top: 10px;
        font-weight: bold;
    }
    .hidden {
        display: none;
    }
</style>
</head>
<body>

<div class="login-box">
    
    <div id="login-view">
        <h2>Connexion Étudiant</h2>
        <form id="loginForm">
            <input type="text" id="username" placeholder="Nom d'utilisateur (e.g. etudiant1)" required>
            <input type="password" id="password" placeholder="Mot de passe (e.g. 123)" required>
            <button type="submit">Se connecter</button>
        </form>
        <span class="toggle-link" onclick="showView('register-view')">S'inscrire</span>
    </div>

    <div id="register-view" class="hidden">
        <h2>Inscription</h2>
        <form id="registerForm">
            <input type="text" id="regUsername" placeholder="Nouveau Nom d'utilisateur" required>
            <input type="password" id="regPassword" placeholder="Mot de passe (min. 3 caractères)" required minlength="3">
            <button type="submit" id="registerBtn">Créer mon compte</button>
        </form>
        <span class="toggle-link" onclick="showView('login-view')">Déjà inscrit ? Se connecter</span>
    </div>

    <div id="mfa-view" class="hidden">
        <h2>Vérification 2FA</h2>
        <p>Un code de vérification a été 'envoyé'.</p>
        <p id="mfa-instruction-debug" style="color: blue; font-weight: bold;"></p>
        <form id="mfaForm">
            <input type="text" id="mfaCode" placeholder="Code à 4 chiffres" required maxlength="4">
            <button type="submit">Vérifier</button>
        </form>
    </div>

    <p id="errorMsg" class="error-message"></p>

</div>

<script>
// Base de données utilisateurs (Simulée)
let USERS = [
    { username: "etudiant1", password: "123", class: "Première" },
    { username: "etudiant2", password: "456", class: "Seconde" }
];

let currentLogin = null;

// Fonction pour afficher la bonne vue
function showView(viewId){
    document.getElementById("login-view").classList.add("hidden");
    document.getElementById("register-view").classList.add("hidden"); 
    document.getElementById("mfa-view").classList.add("hidden");
    document.getElementById(viewId).classList.remove("hidden");
    document.getElementById("errorMsg").textContent = "";
}

// =================================================================
// LOGIQUE D'INSCRIPTION (MODIFIÉE)
// =================================================================

document.getElementById("registerForm").addEventListener("submit", e => {
    e.preventDefault();
    const username = document.getElementById("regUsername").value.trim();
    const password = document.getElementById("regPassword").value.trim();
    // ATTRIBUTION AUTOMATIQUE DE LA CLASSE 'Première'
    const studentClass = "Première"; 
    const errorMsg = document.getElementById("errorMsg");

    if (password.length < 3) {
        errorMsg.textContent = "Le mot de passe doit contenir au moins 3 caractères.";
        return;
    }

    if (USERS.some(u => u.username === username)) {
        errorMsg.textContent = "Ce nom d'utilisateur est déjà pris.";
        return;
    }

    // Ajout du nouvel utilisateur avec la classe 'Première' par défaut
    const newUser = { username, password, class: studentClass };
    USERS.push(newUser);
    
    // Simuler la connexion automatique après l'inscription
    localStorage.setItem("isLoggedIn", "true");
    localStorage.setItem("currentUser", newUser.username);
    localStorage.setItem("studentClass", newUser.class); 
    
    alert(`Compte créé pour ${username} en classe de ${studentClass} !`);
    window.location.replace("index.html");

});


// =================================================================
// LOGIQUE DE CONNEXION (INCHANGÉE)
// =================================================================

// Vérification des identifiants et envoi 2FA
document.getElementById("loginForm").addEventListener("submit", e=>{
    e.preventDefault();
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const user = USERS.find(u => u.username === username);
    const errorMsg = document.getElementById("errorMsg");

    if(user && user.password === password){
        const code = String(Math.floor(1000 + Math.random()*9000));
        currentLogin = { username, code, class: user.class }; 
        
        document.getElementById("mfa-instruction-debug").textContent = `CODE 2FA (DEBUG) : ${code}`;
        
        showView("mfa-view");
    } else {
        errorMsg.textContent = "Identifiants incorrects.";
    }
});

// Vérification 2FA
document.getElementById("mfaForm").addEventListener("submit", e=>{
    e.preventDefault();
    const codeInput = document.getElementById("mfaCode").value.trim();
    const errorMsg = document.getElementById("errorMsg");

    if(!/^\d{4}$/.test(codeInput)){
        errorMsg.textContent = "Le code doit comporter 4 chiffres.";
        return;
    }

    if(codeInput === currentLogin.code){
        localStorage.setItem("isLoggedIn", "true");
        localStorage.setItem("currentUser", currentLogin.username);
        
        // UTILISATION DE LA CLASSE STOCKÉE
        localStorage.setItem("studentClass", currentLogin.class); 
        
        window.location.replace("index.html");
    } else {
        errorMsg.textContent = "Code 2FA incorrect.";
        document.getElementById("mfaCode").value = "";
    }
});

// Vérification de la déconnexion au chargement de la page de connexion
document.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('isLoggedIn') === 'true') {
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('currentUser');
        localStorage.removeItem('studentClass');
    }
    showView("login-view");
});
</script>

</body>
</html>

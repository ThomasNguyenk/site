<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Authentification Ã‰tudiant</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
/* --- DÃ©but de la section CSS (ESTHÃ‰TIQUE AMÃ‰LIORÃ‰E) --- */
:root {
    --primary-color: #4a90e2; /* Bleu clair dynamique */
    --secondary-color: #1a4f8d; /* Bleu marine foncÃ© */
    --background-color: #f0f2f5;
    --text-color: #333;
    --error-color: #d32f2f;
}

body { 
    font-family: 'Poppins', sans-serif; /* Changement de police */
    /* NOUVELLE LIGNE POUR L'IMAGE DE FOND */
    background: url('https://static.vecteezy.com/ti/vecteur-libre/p1/13387658-carte-du-monde-connexion-avec-fond-de-site-web-moderne-futuriste-radar-ou-vecteur-de-page-de-garde-pour-le-concept-de-technologie-et-de-finance-et-l-education-future-entreprise-vectoriel.jpgt') center/cover fixed, linear-gradient(135deg, #f0f2f5 0%, #e8edf3 100%); 
    /* Le dÃ©gradÃ© doux reste en "fallback" si l'image ne charge pas. */
    margin: 0; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    height: 100vh; 
    color: var(--text-color);
    transition: background-color 0.5s;
}

.box { 
    background: #ffffff; 
    padding: 40px; 
    border-radius: 20px; /* Bordures plus douces */
    width: 380px; 
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* Ombre plus douce */
    border: 1px solid #e0e0e0;
    transition: transform 0.3s ease-in-out;
}
.box:hover {
    transform: translateY(-5px); /* Petit effet au survol */
}

h2 {
    margin: 0 0 30px; 
    text-align: center;
    color: var(--secondary-color); 
    font-weight: 700;
}

/* Conteneur pour l'input et l'icÃ´ne */
.input-group {
    position: relative;
    margin: 15px 0;
}

input { 
    width: 100%; 
    padding: 15px; /* Plus d'espace intÃ©rieur */
    border-radius: 10px; /* Bordures d'input plus douces */
    border: 1px solid #ddd; 
    box-sizing: border-box;
    transition: border-color 0.3s, box-shadow 0.3s, background-color 0.3s;
    font-size: 1rem;
} 

input:focus {
    border-color: var(--primary-color); 
    box-shadow: 0 0 8px rgba(74, 144, 226, 0.3); /* Ombre au focus */
    background-color: #fafffe;
    outline: none;
}

/* Style de l'icÃ´ne/du bouton pour basculer la visibilitÃ© */
.toggle-password {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    cursor: pointer;
    color: #b0b0b0; /* Couleur neutre */
    font-size: 1.2rem;
    transition: color 0.2s;
}

.toggle-password:hover {
    color: var(--primary-color);
}

button { 
    width: 100%; 
    padding: 15px; 
    border-radius: 10px; 
    border: none; 
    background: linear-gradient(to right, var(--primary-color), #2f74b5); /* DÃ©gradÃ© de couleur principal */
    color: white; 
    font-weight: 600; 
    font-size: 1.1rem;
    cursor: pointer; 
    margin-top: 25px; 
    transition: transform 0.3s, box-shadow 0.3s, opacity 0.3s; 
}

button:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(74, 144, 226, 0.4);
}

.toggle-link { 
    display: block; 
    text-align: center; 
    margin-top: 25px; 
    color: var(--secondary-color); 
    cursor: pointer; 
    font-size: 0.95rem;
    transition: color 0.3s;
}

.toggle-link:hover {
    color: var(--primary-color);
    text-decoration: underline;
}

.error { 
    color: var(--error-color); 
    font-weight: 600; 
    margin-top: 20px; 
    min-height: 1.2em; 
    text-align: center;
    padding: 5px 0;
}

.small { 
    font-size: 0.8rem; 
    color: #999; 
    margin-top: 15px; 
    text-align: center; 
}

/* Style pour le message 2FA pour meilleure visibilitÃ© */
#mfa-send-message {
    text-align: center;
    line-height: 1.5;
    margin-bottom: 20px;
    padding: 10px;
    border: 1px dashed #ddd;
    border-radius: 8px;
    background-color: #f7f9fc;
}
/* --- Fin de la section CSS (ESTHÃ‰TIQUE AMÃ‰LIORÃ‰E) --- */
</style>
</head>
<body>
Â  <div class="box">
Â  Â  <div id="login-view">
Â  Â  Â  <h2>Connexion Ã‰tudiant</h2>
Â  Â  Â  <form id="loginForm">
Â  Â  Â  Â  <div class="input-group">
            <input type="text" id="username" placeholder="Nom d'utilisateur" required />
        </div>
        
        <div class="input-group">
            <input type="password" id="password" placeholder="Mot de passe" required />
            <span class="toggle-password" data-target="password">ğŸ‘ï¸</span>
        </div>
        Â  Â  Â  Â  <button type="submit">Se connecter</button>
Â  Â  Â  </form>
Â  Â  Â  <span class="toggle-link" onclick="showView('register-view')">CrÃ©er un compte</span>
Â  Â  Â  <div class="small">Les comptes sont stockÃ©s localement sur ce navigateur.</div>
Â  Â  </div>

Â  Â  <div id="register-view" style="display:none">
Â  Â  Â  <h2>Inscription</h2>
Â  Â  Â  <form id="registerForm">
Â  Â  Â  Â  <div class="input-group">
            <input type="text" id="regUsername" placeholder="Nom d'utilisateur" required />
        </div>
Â  Â  Â  Â  <div class="input-group">
            <input type="password" id="regPassword" placeholder="Mot de passe (min 3)" minlength="3" required />
            <span class="toggle-password" data-target="regPassword">ğŸ‘ï¸</span>
        </div>
Â  Â  Â  Â  <button type="submit">CrÃ©er mon compte</button>
Â  Â  Â  </form>
Â  Â  Â  <span class="toggle-link" onclick="showView('login-view')">DÃ©jÃ  inscrit ? Se connecter</span>
Â  Â  Â  <div class="small">Ton compte et tes donnÃ©es resteront sur ce navigateur (localStorage).</div>
Â  Â  </div>

Â  Â  <div id="mfa-view" style="display:none">
Â  Â  Â  <h2>VÃ©rif. (2FA)</h2>
Â  Â  Â  Â  Â  Â  <p id="mfa-send-message">Veuillez entrer le code de vÃ©rification Ã  4 chiffres.</p> 
Â  Â  Â  <form id="mfaForm">
Â  Â  Â  Â  <div class="input-group">
             <input type="text" id="mfaCode" placeholder="Code (alÃ©atoire)" maxlength="4" required />
        </div>
Â  Â  Â  Â  <button type="submit">VÃ©rifier et Se connecter</button>
Â  Â  Â  </form>
Â  Â  Â  <span class="toggle-link" onclick="showView('login-view')">Annuler et Retour Ã  la Connexion</span>
Â  Â  </div>

Â  Â  <div id="errorMsg" class="error"></div>
Â  </div>

<script>
Â  // USERS stored in localStorage under key 'USERS' as JSON array
Â  function loadUsers(){
Â  Â  try { return JSON.parse(localStorage.getItem('USERS')||'[]'); } catch(e){ return []; }
Â  }
Â  function saveUsers(users){ localStorage.setItem('USERS', JSON.stringify(users)); }

Â  // UI helpers
Â  function showView(id){
Â  Â  document.getElementById('login-view').style.display='none';
Â  Â  document.getElementById('register-view').style.display='none';
Â  Â  document.getElementById('mfa-view').style.display='none';
Â  Â  document.getElementById(id).style.display='block';
Â  Â  document.getElementById('errorMsg').textContent='';
Â  }
  
Â  // Fonction pour finaliser la connexion aprÃ¨s le 2FA
Â  function finaliseLogin(user) {
    // Nettoie le code 2FA aprÃ¨s usage
    currentMfaCode = null;
    
    // success -> store activeUser
Â  Â  localStorage.setItem('activeUser', user.username);
Â  Â  // Utilise la classe enregistrÃ©e de l'utilisateur ou 'PremiÃ¨re' par dÃ©faut
Â  Â  localStorage.setItem('studentClass', user.class || 'PremiÃ¨re'); 
Â  Â  // ensure per-user keys exist
Â  Â  if(!localStorage.getItem(`progress_${user.username}`)) localStorage.setItem(`progress_${user.username}`, JSON.stringify({ daily:{}, weekly:{} }));
Â  Â  if(!localStorage.getItem(`notes_${user.username}`)) localStorage.setItem(`notes_${user.username}`, JSON.stringify([]));
Â  Â  window.location.href = 'index.html';
Â  }

Â  // Variable globale pour stocker l'utilisateur en cours de connexion
Â  let userPending2FA = null;
Â  // NOUVEAU : Variable globale pour stocker le code 2FA gÃ©nÃ©rÃ©
Â  let currentMfaCode = null;


    // NOUVEAU : Fonction pour gÃ©nÃ©rer un code alÃ©atoire de 4 chiffres
    function generateMfaCode() {
        return Math.floor(1000 + Math.random() * 9000).toString();
    }

    // MISE Ã€ JOUR : Fonction pour mettre Ã  jour le message 2FA (gÃ©nÃ©rique et dynamique)
    function updateMfaMessage() {
        const messageElement = document.getElementById('mfa-send-message');
        if (messageElement && currentMfaCode) {
            // Affichage gÃ©nÃ©rique du code gÃ©nÃ©rÃ©
            messageElement.innerHTML = `Veuillez entrer le code de vÃ©rification : <br><strong><span style="color: #1a4f8d; font-size: 1.6em; letter-spacing: 5px;">${currentMfaCode}</span></strong>`;
        }
    }


Â  // FonctionnalitÃ© : Basculement du Mot de Passe
Â  document.querySelectorAll('.toggle-password').forEach(toggle => {
Â  Â  toggle.addEventListener('click', function() {
Â  Â  Â  const targetId = this.getAttribute('data-target');
Â  Â  Â  const passwordInput = document.getElementById(targetId);
Â  Â  Â  
Â  Â  Â  if (passwordInput.type === 'password') {
Â  Â  Â  Â  passwordInput.type = 'text';
Â  Â  Â  Â  this.textContent = 'ğŸ™ˆ';
Â  Â  Â  } else {
Â  Â  Â  Â  passwordInput.type = 'password';
Â  Â  Â  Â  this.textContent = 'ğŸ‘ï¸';
Â  Â  Â  }
Â  Â  });
Â  });

Â  // Register
Â  document.getElementById('registerForm').addEventListener('submit', e=>{
Â  Â  e.preventDefault();
Â  Â  const username = document.getElementById('regUsername').value.trim();
Â  Â  const password = document.getElementById('regPassword').value;
Â  Â  
Â  Â  const studentClass = 'PremiÃ¨re'; 
Â  Â  const err = document.getElementById('errorMsg');
Â  Â  err.textContent='';

Â  Â  if(password.length < 3){ err.textContent='Mot de passe trop court.'; return; }
Â  Â  const users = loadUsers();
Â  Â  if(users.some(u => u.username.toLowerCase() === username.toLowerCase())){ err.textContent='Nom dâ€™utilisateur dÃ©jÃ  pris.'; return; }

Â  Â  // create user (sans email/tÃ©lÃ©phone)
Â  Â  const newUser = { username, password, class: studentClass, createdAt: (new Date()).toISOString() };
Â  Â  users.push(newUser);
Â  Â  saveUsers(users);

Â  Â  // GÃ©nÃ©ration du code et mise Ã  jour de la vue 2FA
    userPending2FA = newUser;
    currentMfaCode = generateMfaCode(); // GÃ©nÃ¨re le nouveau code
    updateMfaMessage(); // Affiche le code gÃ©nÃ©rÃ©
    showView('mfa-view');
Â  });

Â  // Login
Â  document.getElementById('loginForm').addEventListener('submit', e=>{
Â  Â  e.preventDefault();
Â  Â  const username = document.getElementById('username').value.trim();
Â  Â  const password = document.getElementById('password').value;
Â  Â  const err = document.getElementById('errorMsg');
Â  Â  err.textContent='';

Â  Â  const users = loadUsers();
Â  Â  const user = users.find(u => u.username.toLowerCase() === username.toLowerCase());
Â  Â  if(!user){ err.textContent = "Utilisateur introuvable. CrÃ©e un compte."; return; }
Â  Â  if(user.password !== password){ err.textContent = "Mot de passe incorrect."; return; }
    
Â  Â  // SuccÃ¨s de la connexion, demande le 2FA
    userPending2FA = user;
    currentMfaCode = generateMfaCode(); // GÃ©nÃ¨re le nouveau code
    
    // Mise Ã  jour du message
    updateMfaMessage();
    
Â  Â  showView('mfa-view');
Â  Â  document.getElementById('errorMsg').textContent = 'VÃ©rification 2FA requise. Entrez le code.';
Â  });

Â  // MFA (Double Authentification)
Â  document.getElementById('mfaForm').addEventListener('submit', e=>{
Â  Â  e.preventDefault();
Â  Â  const code = document.getElementById('mfaCode').value.trim();
Â  Â  const err = document.getElementById('errorMsg');
Â  Â  err.textContent = '';
Â  Â  
Â  Â  if(!userPending2FA) {
Â  Â      err.textContent = "Erreur de session. Veuillez vous reconnecter.";
Â  Â      showView('login-view');
Â  Â      return;
Â  Â  }
    
    // VÃ©rification contre le code gÃ©nÃ©rÃ© dynamiquement
Â  Â  if(code === currentMfaCode){ 
Â  Â      alert(`VÃ©rification OK ! Bienvenue, ${userPending2FA.username}.`);
Â  Â      finaliseLogin(userPending2FA); // Finalise la connexion et redirige
Â  Â  } else {
Â  Â      err.textContent = 'Code incorrect. Veuillez rÃ©essayer.';
Â  Â  }
Â  });

Â  // On load, create default users if none (optional)
Â  (function ensureDefaultUsers(){
Â  Â  const u = loadUsers();
Â  Â  if(u.length === 0){
Â  Â  Â  const defaults = [
Â  Â  Â  Â  { username:'etudiant1', password:'123', class:'PremiÃ¨re' },
Â  Â  Â  Â  { username:'etudiant2', password:'456', class:'Seconde' }
Â  Â  Â  ];
Â  Â  Â  saveUsers(defaults);
Â  Â  }
Â  })();
</script>
</body>
</html>
